{% extends 'new_base.html' %}
{% block title %}
  Transfer Log
{% endblock %}
{% block table %}
        <div class="row">
          <div class="col-md-12">
            <div class="card card-default">
              <div class="card-header bg-warning">
                <h3 class="card-title">Asset Transfer Log</h3>
              </div>
              <div class="card-body p-0">
                <div class="bs-stepper">
                  <div class="bs-stepper-header" role="tablist">
                    <!-- your steps here -->
                    <div class="step" data-target="#logins-part">
                      <button type="button" class="step-trigger" role="tab" aria-controls="logins-part" id="logins-part-trigger">
                        <span class="bs-stepper-circle">1</span>
                        <span class="bs-stepper-label">Initiate Transaction</span>
                      </button>
                    </div>
                  </div>
                  <div class="bs-stepper-content">
                    <!-- your steps content here -->
                    <div id="logins-part" class="content" role="tabpanel" aria-labelledby="logins-part-trigger">
                  <form method="post" id="transaction">
                    {% csrf_token %}
                      <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <div class="form-group">
                                   <div class="form-group row">
                                      <label class="col-sm-4 col-form-label"><b>Transfer Type</b></label>

                                      <div class="col-sm-6">
                                        <h1 class="text-success">INTERNAL </h1>
                                      </div>

                                    </div>
                                </div>
                            </div>
                        </div>
<!--                        <div class="col-md-6">-->
<!--                            <div class="form-group row">-->
<!--                                <div class="form-group">-->
<!--                                   <div class="form-group row">-->
<!--                                      <label class="col-sm-2 col-form-label"><b>Reason</b></label>-->
<!--                                       {% for reason in reasons %}-->
<!--                                      <div class="col-sm-3">-->
<!--                                        <div class="form-check">-->
<!--                                          <label class="form-check-label">-->
<!--                                            <input type="radio" class="form-check-input" name="reason" value="{{reason.name}}" id="reason" required>-->
<!--                                            {{ reason.name }}-->
<!--                                          </label>-->
<!--                                        </div>-->
<!--                                      </div>-->
<!--                                       {% endfor %}-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
                          <div class="col-md-6">
                            <div class="form-group row">
                                <div class="form-group">
                                  <label><b>Reason For Transfer</b></label>
                                  <input type="text" class="form-control" id="reason_for_transfer" name="reason_for_transfer" placeholder="eg Addition "
                                   autocapitalize="on" autocomplete="off" required/>
                                </div>
                            </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <div class="form-group">
                                  <label><b>Transaction Assets</b></label>
                                    <select class="form-control select2" data-placeholder="Select Assets" style="width: 100%;" name="assets" id="assets" multiple>
                                    {% for asset in assets %}
                                        <option value="{{asset.id}}" class="form-control">{{asset.tag}}</option>
                                    {% endfor %}
                                  </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group row">
                                <div class="form-group">
                                  <label><b>User Assigned</b></label>
                                  <select class="form-control select2" data-placeholder="Select Assignee" style="width: 100%;" name="user" id="user">
                                    <option selected disabled>Recipient User</option>
                                    {% for user in users %}
                                      {% if user.username == request.user.username %}

                                      {% else %}
                                        <option value="{{user.username}}" class="form-control"   >{{user.first_name}} {{ user.last_name}} </option>
                                      {% endif %}
                                    {% endfor %}
                                  </select>
                                </div>
                            </div>
                        </div>
                      </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group row">
                            <div class="form-group">
                              <label><b>Request Authorization From Manager</b></label>
                              <select class="form-control select2" data-placeholder="Select Manager" style="width: 100%;" name="approver" id="approver" >
                                <option selected disabled>Authorizer</option>
                                {% for user in users %}
                                  {% if request.user.employee.line_manager == user %}
                                    <option value="{{user.username}}" class="form-control">{{user.first_name}} {{ user.last_name}}</option>
                                  {% endif %}
                                {% endfor %}
                              </select>
                            </div>
                        </div>
                    </div>
                  </div>
                      <div class="row">
                          {% if messages %}
                              <ul class="">
                                  {% for message in messages %}
                                      {% if message.tags %}
                                          <h4 class="{{ message.tags }} text-center {% if message.tags == 'warning' %} text-danger {% else %} text-success {% endif %} ">
                                      {{ message }}</h4>
                                  {% endif %}
                                  {% endfor %}
                              </ul>
                          {% endif %}
                        </div>
                      <button class="btn btn-warning" type="submit">Initiate Transfer</button>
                  </form>
                    </div>

                  </div>
                </div>
              </div>
              <!-- /.card-body -->
              <div class="card-footer bg-warning">

              </div>
            </div>
            <!-- /.card -->
          </div>
        </div>
{% endblock %}
{% block js %}
 $(function () {
    //Initialize Select2 Elements
    $('.select2').select2()

    //Initialize Select2 Elements
    $('.select2bs4').select2({
      theme: 'bootstrap4'
    })
})


<!--$(document).on("submit", "#transaction", function (e) {-->
<!--    e.preventDefault();-->
<!--    var Toast = Swal.mixin({-->
<!--           toast: true,-->
<!--           position: 'top-end',-->
<!--           showConfirmButton: false,-->
<!--           timer: 3000-->
<!--    });-->

<!--        $.ajax({-->
<!--            url: "/api/asset_list",-->
<!--            // on success-->
<!--            success: function (response) {-->
<!--                assets = $('#assets').val();-->

<!--                for (var i = 0; i < assets.length; i++) {-->
<!--                        for( var key in response){-->
<!--                            assets = $('#assets').val();-->
<!--                            if(assets[i] != ""){-->
<!--                                if (response[key].tag==assets[i]){-->
<!--                                    if(response[key].locked == false){-->
<!--                                                $.ajax({-->
<!--                                                    type: 'POST',-->
<!--                                                    url: "/abcassetsmanager/transfer_multiple",-->
<!--                                                    data: {-->
<!--                                                        assets: $('#assets').val(),-->
<!--                                                        user : $('#user').val(),-->

<!--                                                        type: $("input[name='type']:checked").val(),-->
<!--                                                        approver: $('#approver').val(),-->
<!--                                                        reason: $("input[name='reason']:checked").val(),-->
<!--                                                        csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),-->
<!--                                                        success: function(data){-->
<!--                                                               Toast.fire({-->
<!--                                                                    icon: 'success',-->
<!--                                                                    title: 'Transaction Sent For Authorization',-->
<!--                                                               })-->
<!--                                                              $('#transaction').trigger("reset");-->
<!--                                                              $("#user option").prop("selected", false).trigger( "change" );-->
<!--                                                              $("#assets option").prop("selected", false).trigger( "change" );-->
<!--                                                        }-->
<!--                                                    }-->
<!--                                                })-->
<!--                                    }else{-->
<!--                                            console.log("Asset is locked")-->
<!--                                            Toast.fire({-->
<!--                                                icon: 'error',-->
<!--                                                title: 'Asset is in another transaction',-->
<!--                                            })-->
<!--                                    }-->
<!--                                }else if(assets[i] == ""){-->
<!--                                    Toast.fire({-->
<!--                                                icon: 'error',-->
<!--                                                title: 'Kindly Add Asset',-->
<!--                                    })-->
<!--                                }-->
<!--                            }else{-->
<!--                                console.log("no match");-->
<!--                            }-->
<!--                        }-->
<!--                }-->
<!--            }-->
<!--        })-->
<!--})-->

{% endblock %}